<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  base-uri 'self';
  object-src 'none';
  form-action 'self';
  script-src 'self';
  style-src 'self' 'unsafe-inline';
  img-src 'self' data: blob:;
  font-src 'self';
  connect-src 'self';
  media-src 'self' blob:;
  worker-src 'self' blob:;
">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="app-version" content="0.3.0" />

  <title>Campaign Tracker</title>

  <script src="boot.js"></script>
  <link rel="stylesheet" href="styles.css" />

  <!-- Favicons -->
  <link rel="icon" href="icons/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <!-- Optional: Android / PWA icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
</head>

<body>
  <header class="topbar">
    <div class="titlewrap">
      <h1 id="campaignTitle" contenteditable="true" spellcheck="false">My Campaign</h1>
      <div class="muted" id="statusText"></div>
    </div>

    <div class="topbarCenter">
      <div id="topbarClock" class="clockChip" aria-label="Current time"></div>
    </div>

    <div class="topbarRight">
      <nav class="tabs" role="tablist" aria-label="Pages">
        <button class="tab active" data-tab="tracker" role="tab" aria-selected="true">Tracker</button>
        <button class="tab" data-tab="character" role="tab" aria-selected="false">Character</button>
        <button class="tab" data-tab="map" role="tab" aria-selected="false">Map</button>
      </nav>

      <!-- Calculator dropdown -->
      <div class="calcDropdown" id="calcDropdown">
        <button id="calcBtn" class="tab calcBtn" type="button" aria-haspopup="true" aria-expanded="false"
          title="Calculator">
          <span id="calcBtnIcon" class="iconMask btnIcon" aria-hidden="true"
            style="--icon:url('icons/calcIcon.svg');"></span>
        </button>

        <div class="calcMenu" id="calcMenu" hidden>
          <div class="calcTop">
            <div class="calcTitle">Calculator</div>
            <button id="calcCloseBtn" type="button" class="calcClose" title="Close">X</button>
          </div>

          <input id="calcDisplay" class="calcDisplay" inputmode="decimal" autocomplete="off" placeholder="0"
            aria-label="Calculator input" />

          <div class="calcKeys" aria-label="Calculator keys">
            <button type="button" data-k="7">7</button>
            <button type="button" data-k="8">8</button>
            <button type="button" data-k="9">9</button>
            <button type="button" data-k="/">÷</button>

            <button type="button" data-k="4">4</button>
            <button type="button" data-k="5">5</button>
            <button type="button" data-k="6">6</button>
            <button type="button" data-k="*">×</button>

            <button type="button" data-k="1">1</button>
            <button type="button" data-k="2">2</button>
            <button type="button" data-k="3">3</button>
            <button type="button" data-k="-">−</button>

            <button type="button" data-k="0" class="wide">0</button>
            <button type="button" data-k=".">.</button>
            <button type="button" data-k="+">+</button>

            <button type="button" data-k="C" class="danger">C</button>
            <button type="button" data-k="⌫">⌫</button>
            <button type="button" data-k="=" class="equals">=</button>
          </div>

          <div class="calcHistoryWrap">
            <div class="calcHistoryTitle">History</div>
            <div id="calcHistory" class="calcHistory"></div>
          </div>
        </div>
      </div>

      <!-- Dice Roller dropdown -->
      <div class="diceDropdown" id="diceDropdown">
        <button id="diceBtn" class="tab diceBtn" type="button" aria-haspopup="true" aria-expanded="false"
          title="Dice Roller">
          <span id="diceBtnIcon" class="iconMask diceIconImg" aria-hidden="true"
            style="--icon:url('icons/dice/d20.svg');"></span>
        </button>
        <div class="diceMenu" id="diceMenu" hidden>
          <div class="diceTop">
            <div class="diceTitle">Dice Roller</div>
            <button id="diceCloseBtn" type="button" class="diceClose" title="Close">X</button>
          </div>

          <div class="diceTopRow" aria-label="Dice inputs">
            <label class="diceField diceCountField">
              <div class="mutedSmall diceCountLabel">#</div>
              <input id="diceCount" type="number" min="1" max="100" step="1" value="1" inputmode="numeric" />
            </label>

            <!-- NEW: big active die icon -->
            <div class="diceHero" aria-hidden="true">
              <span id="diceActiveIcon" class="iconMask diceActiveIcon"
                style="--icon:url('icons/dice/d20.svg');"></span>
            </div>

            <label class="diceField diceModField">
              <div class="mutedSmall diceModLabel">Mod</div>
              <div class="modWrap">
                <span id="diceModPlus" class="modPlus" aria-hidden="true">+</span>
                <input id="diceMod" type="number" step="1" inputmode="numeric" />
              </div>
            </label>
          </div>

          <!-- NEW: 3-button roll row (even spacing) -->
          <div class="diceRollRow" aria-label="Roll controls">
            <button id="diceDisBtn" type="button" class="diceAltBtn">Dis</button>
            <button id="diceRollBtn" type="button" class="diceRollBtn">Roll</button>
            <button id="diceAdvBtn" type="button" class="diceAltBtn">Adv</button>
          </div>

          <!-- Clear sits under, like your sketch -->
          <div class="diceActions">
            <button id="diceClearBtn" type="button" class="diceClearBtn danger" title="Clear history">Clear</button>
          </div>

          <!-- NEW: icon presets (select die, do NOT roll) -->
          <div class="dicePresets" aria-label="Choose die">
            <button type="button" class="dicePreset" data-sides="4" aria-label="d4">
              <span class="iconMask dicePresetIcon" aria-hidden="true" style="--icon:url('icons/dice/d4.svg');"></span>
            </button>
            <button type="button" class="dicePreset" data-sides="6" aria-label="d6">
              <span class="iconMask dicePresetIcon" aria-hidden="true" style="--icon:url('icons/dice/d6.svg');"></span>
            </button>
            <button type="button" class="dicePreset" data-sides="8" aria-label="d8">
              <span class="iconMask dicePresetIcon" aria-hidden="true" style="--icon:url('icons/dice/d8.svg');"></span>
            </button>
            <button type="button" class="dicePreset" data-sides="10" aria-label="d10">
              <span class="iconMask dicePresetIcon" aria-hidden="true" style="--icon:url('icons/dice/d10.svg');"></span>
            </button>
            <button type="button" class="dicePreset" data-sides="12" aria-label="d12">
              <span class="iconMask dicePresetIcon" aria-hidden="true" style="--icon:url('icons/dice/d12.svg');"></span>
            </button>
            <button type="button" class="dicePreset" data-sides="20" aria-label="d20">
              <span class="iconMask dicePresetIcon" aria-hidden="true" style="--icon:url('icons/dice/d20.svg');"></span>
            </button>
            <button type="button" class="dicePreset" data-sides="100" aria-label="d100">
              <span class="iconMask dicePresetIcon" aria-hidden="true"
                style="--icon:url('icons/dice/d100.svg');"></span>
            </button>
          </div>

          <div class="diceHistoryWrap">
            <div class="diceHistoryTitle">History</div>
            <div id="diceHistory" class="diceHistory"></div>
          </div>
        </div>
      </div>

      <!-- Settings -->
      <!-- Settings -->
      <button id="settingsBtn" class="tab settingsBtn" type="button" title="Data &amp; Settings"
        aria-label="Data & Settings">
        <span class="iconMask settingsBtnIcon" aria-hidden="true" style="--icon:url('icons/settingsIcon.svg');"></span>
      </button>
    </div>
  </header>

  <main>
    <!-- TRACKER PAGE -->
    <section class="page active" id="page-tracker">
      <div class="trackerColumns" id="trackerColumns">
        <div class="trackerCol" id="trackerCol0">

          <section class="panel" id="sessionPanel">
            <div class="sessionHeader">
              <h2 class="m0">Sessions</h2>

              <div class="sessionControls panelControls">
                <button id="addSessionBtn" class="panelBtn panelBtnSm" title="Add a new session">+ Session</button>
                <button id="renameSessionBtn" class="panelBtn panelBtnSm" title="Rename current session">Rename</button>
                <button id="deleteSessionBtn" class="danger panelBtn panelBtnSm panelDelete"
                  title="Delete current session">Delete</button>
                <input id="sessionSearch" class="sessionSearch panelSearch" placeholder="Search sessions..." />
              </div>
            </div>

            <div class="sessionTabsWrap" role="tablist" aria-label="Sessions">
              <div id="sessionTabs" class="sessionTabs"></div>
            </div>

            <textarea id="sessionNotesBox" data-persist-size placeholder="Notes for this session..."></textarea>
          </section>

          <section class="panel" id="npcPanel">
            <div class="npcHeader">
              <h2 class="m0">NPCs</h2>

              <div class="npcControls panelControls">
                <button id="addNpcBtn" class="panelBtn panelBtnSm" title="Add NPC">+ NPC</button>

                <button id="addNpcSectionBtn" class="panelBtn panelBtnSm" title="Add NPC Section">+ Section</button>
                <button id="renameNpcSectionBtn" class="panelBtn panelBtnSm"
                  title="Rename Selected Section">Rename</button>
                <button id="deleteNpcSectionBtn" class="danger panelBtn panelBtnSm panelDelete"
                  title="Delete Selected Section">Delete</button>

                <input id="npcSearch" class="npcSearch panelSearch" placeholder="Search NPCs..." />
              </div>
            </div>

            <!-- <div class="npcTabsWrap" role="tablist" aria-label="NPC Sections"> -->
            <div class="sessionTabsWrap" role="tablist" aria-label="Sessions">
              <div id="npcTabs" class="sessionTabs"></div>
            </div>

            <div id="npcCards" class="npcCards"></div>
          </section>

          <section class="panel" id="partyPanel">
            <div class="partyHeader">
              <h2 class="m0">Party</h2>

              <div class="partyControls panelControls">
                <button id="addPartyBtn" class="panelBtn panelBtnSm" title="Add Party Member">+ Member</button>

                <button id="addPartySectionBtn" class="panelBtn panelBtnSm" title="Add Party Section">+ Section</button>
                <button id="renamePartySectionBtn" class="panelBtn panelBtnSm"
                  title="Rename Selected Section">Rename</button>
                <button id="deletePartySectionBtn" class="danger panelBtn panelBtnSm panelDelete"
                  title="Delete Selected Section">Delete</button>

                <input id="partySearch" class="partySearch panelSearch" placeholder="Search party..." />
              </div>
            </div>

            <!-- ✅ Party Sections (NPC-style tabs) -->
            <!-- <div class="npcTabsWrap" role="tablist" aria-label="Party Sections"> -->
            <div class="sessionTabsWrap" role="tablist" aria-label="Sessions">
              <div id="partyTabs" class="sessionTabs"></div>
            </div>

            <div id="partyCards" class="partyCards"></div>
          </section>

          <section class="panel" id="locationsPanel">
            <div class="locHeader">
              <h2 class="m0">Locations</h2>

              <div class="locControls panelControls">
                <button id="addLocBtn" class="panelBtn panelBtnSm" title="Add Location">+ Place</button>

                <button id="addLocSectionBtn" class="panelBtn panelBtnSm" title="Add Location Section">+
                  Section</button>
                <button id="renameLocSectionBtn" class="panelBtn panelBtnSm"
                  title="Rename Selected Section">Rename</button>
                <button id="deleteLocSectionBtn" class="danger panelBtn panelBtnSm panelDelete"
                  title="Delete Selected Section">Delete</button>

                <select id="locFilter" class="locFilter panelSelect" title="Filter by type">
                  <option value="all">All</option>
                  <option value="town">Town</option>
                  <option value="dungeon">Dungeon</option>
                  <option value="region">Region</option>
                  <option value="other">Other</option>
                </select>

                <input id="locSearch" class="locSearch panelSearch" placeholder="Search locations..." />
              </div>
            </div>

            <!-- <div class="npcTabsWrap" role="tablist" aria-label="Location Sections"> -->
            <div class="sessionTabsWrap" role="tablist" aria-label="Sessions">
              <div id="locTabs" class="sessionTabs"></div>
            </div>

            <div id="locCards" class="locCards"></div>
          </section>

          <section class="panel" id="miscPanel">
            <div class="panelHeader">
              <h2 class="m0">Loose Notes</h2>
            </div>
            <textarea id="misc" data-persist-size placeholder="Anything else..."></textarea>
          </section>

        </div>
        <div class="trackerCol" id="trackerCol1"></div>
      </div>
    </section>

    <!-- CHARACTER PAGE -->
    <section class="page" id="page-character">
      <div class="charColumns" id="charColumns">
        <div class="charCol" id="charCol0">
          <section class="panel" id="charBasicsPanel">
            <div class="row between items-end">
              <h2 class="m0">Character</h2>
            </div>
            <div class="charBasicsLayout">
              <!-- portrait column -->
              <div class="npcCard charPortraitCard" id="charPortraitCard">
                <div class="npcPortraitTop charPortraitTop" id="charPortraitTop"></div>
              </div>

              <!-- fields column -->
              <div class="charBasicsGrid">
                <input id="charName" placeholder="Name" />
                <input id="charClassLevel" placeholder="Class & Level (e.g., Sorcerer 5)" />

                <div class="charTwo">
                  <input id="charRace" placeholder="Race" />
                  <input id="charBackground" placeholder="Background" />
                </div>

                <div class="charTwo">
                  <input id="charAlignment" placeholder="Alignment" />
                  <input id="charExperience" type="number" placeholder="Experience" />
                </div>

                <div class="fieldLabelRow">
                  <div class="fieldLabel">Features / Traits</div>
                  <button type="button" class="panelCollapseBtn" data-collapse-target="charFeatures"
                    aria-expanded="true" title="Collapse/Expand">▾</button>
                </div>

                <textarea id="charFeatures" data-persist-size placeholder="Features / Traits..."></textarea>
              </div>
          </section>

          <section class="panel" id="charVitalsPanel">
            <div class="panelHeader">
              <h2 class="m0">Vitals</h2>
              <button id="addResourceBtn" type="button" class="headerAddBtn" title="Add another resource tracker">+
                Resource</button>
            </div>

            <div class="charTiles" id="charVitalsTiles">

              <div class="charTile" data-vital-key="hp">
                <div class="charTileLabel">HP</div>
                <div class="charHpRow">
                  <input id="charHpCur" type="number" placeholder="Cur" />
                  <span class="muted">/</span>
                  <input id="charHpMax" type="number" placeholder="Max" />
                </div>
              </div>

              <div class="charTile" data-vital-key="hitDie">
                <div class="charTileLabel">Hit Dice</div>
                <div class="charHpRow">
                  <input id="hitDieAmt" type="number" placeholder="2" />
                  <span class="muted">d</span>
                  <input id="hitDieSize" type="number" placeholder="6" />
                </div>
              </div>

              <div class="charTile" data-vital-key="ac">
                <div class="charTileLabel">Armor Class</div>
                <input id="charAC" type="number" placeholder="AC" />
              </div>

              <div class="charTile" data-vital-key="init">
                <div class="charTileLabel">Initiative</div>
                <input id="charInit" type="number" placeholder="Init" />
              </div>

              <div class="charTile" data-vital-key="speed">
                <div class="charTileLabel">Speed</div>
                <input id="charSpeed" type="number" placeholder="Speed" />
              </div>

              <div class="charTile" data-vital-key="prof">
                <div class="charTileLabel">Proficiency</div>
                <input id="charProf" type="number" placeholder="+X" />
              </div>

              <div class="charTile" data-vital-key="spellAtk">
                <div class="charTileLabel">Spell Attack</div>
                <input id="charSpellAtk" type="number" placeholder="+X" />
              </div>

              <div class="charTile" data-vital-key="spellDC">
                <div class="charTileLabel">Spell DC</div>
                <input id="charSpellDC" type="number" placeholder="DC" />
              </div>
            </div>
          </section>

          <section class="panel" id="charAbilitiesPanel">
            <div class="panelHeader items-center abilitiesHeader">
              <h2 class="m0">Abilities & Skills</h2>

              <div class="saveOptionsDropdown" id="saveOptionsDropdown">
                <button id="saveOptionsBtn" type="button" class="moveBtn" aria-haspopup="true" aria-expanded="false"
                  title="Save options">⋯</button>

                <div class="saveOptionsMenu" id="saveOptionsMenu" hidden>
                  <div class="saveOptionsTitle">Misc Save Bonus</div>

                  <div class="saveOptionsGrid">
                    <div class="saveOpt">
                      <div class="saveOptTop"><input id="miscSave_str" type="number" /></div>
                      <div class="saveOptLabel">Str Save</div>
                    </div>
                    <div class="saveOpt">
                      <div class="saveOptTop"><input id="miscSave_dex" type="number" /></div>
                      <div class="saveOptLabel">Dex Save</div>
                    </div>
                    <div class="saveOpt">
                      <div class="saveOptTop"><input id="miscSave_con" type="number" /></div>
                      <div class="saveOptLabel">Con Save</div>
                    </div>

                    <div class="saveOpt">
                      <div class="saveOptTop"><input id="miscSave_int" type="number" /></div>
                      <div class="saveOptLabel">Int Save</div>
                    </div>
                    <div class="saveOpt">
                      <div class="saveOptTop"><input id="miscSave_wis" type="number" /></div>
                      <div class="saveOptLabel">Wis Save</div>
                    </div>
                    <div class="saveOpt">
                      <div class="saveOptTop"><input id="miscSave_cha" type="number" /></div>
                      <div class="saveOptLabel">Cha Save</div>
                    </div>
                  </div>

                  <div class="settingsDivider"></div>

                  <div class="saveOptionsRow">
                    <div class="saveOptionsRowLabel">Ability Mod To All Saves</div>
                    <select id="saveModToAllSelect" class="settingsSelect abilitySaves"
                      title="Ability Mod To All Saves">
                      <option value="">None</option>
                      <option value="str">Str</option>
                      <option value="dex">Dex</option>
                      <option value="con">Con</option>
                      <option value="int">Int</option>
                      <option value="wis">Wis</option>
                      <option value="cha">Cha</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="abilityGrid">

              <!-- STRENGTH -->
              <div class="abilityBlock" data-ability="str">
                <div class="abilityHeader">
                  <div class="abilityTitle">Strength</div>

                  <div class="abilityStats">
                    <input type="number" class="abilityScore" data-stat="score" />
                    <div class="abilityStat">Mod <span data-stat="mod">+0</span></div>
                    <div class="abilityStat">Save <span data-stat="save">+0</span>
                      <input type="checkbox" data-stat="saveProf" />
                    </div>
                  </div>
                </div>

                <div class="abilitySkills">
                  <div class="skillRow">
                    <input type="checkbox" data-skill-prof="athletics" />
                    <span>Athletics</span>
                    <span data-skill-value="athletics">+0</span>
                  </div>
                </div>
              </div>

              <!-- DEXTERITY -->
              <div class="abilityBlock" data-ability="dex">
                <div class="abilityHeader">
                  <div class="abilityTitle">Dexterity</div>

                  <div class="abilityStats">
                    <input type="number" class="abilityScore" data-stat="score" />
                    <div class="abilityStat">Mod <span data-stat="mod">+0</span></div>
                    <div class="abilityStat">
                      Save <span data-stat="save">+0</span>
                      <input type="checkbox" data-stat="saveProf" />
                    </div>
                  </div>
                </div>

                <div class="abilitySkills">
                  <div class="skillRow"><input type="checkbox"
                      data-skill-prof="acrobatics" /><span>Acrobatics</span><span
                      data-skill-value="acrobatics">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="sleight" /><span>Sleight of
                      Hand</span><span data-skill-value="sleight">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="stealth" /><span>Stealth</span><span
                      data-skill-value="stealth">+0</span></div>
                </div>
              </div>

              <!-- CONSTITUTION -->
              <div class="abilityBlock" data-ability="con">
                <div class="abilityHeader">
                  <div class="abilityTitle">Constitution</div>
                  <div class="abilityStats">
                    <input type="number" class="abilityScore" data-stat="score" />
                    <div class="abilityStat">Mod <span data-stat="mod">+0</span></div>
                    <div class="abilityStat">
                      Save <span data-stat="save">+0</span>
                      <input type="checkbox" data-stat="saveProf" />
                    </div>
                  </div>
                </div>

                <div class="abilitySkills">
                  <div class="mutedSmall">No skills use Constitution</div>
                </div>
              </div>

              <!-- INTELLIGENCE -->
              <div class="abilityBlock" data-ability="int">
                <div class="abilityHeader">
                  <div class="abilityTitle">Intelligence</div>
                  <div class="abilityStats">
                    <input type="number" class="abilityScore" data-stat="score" />
                    <div class="abilityStat">Mod <span data-stat="mod">+0</span></div>
                    <div class="abilityStat">
                      Save <span data-stat="save">+0</span>
                      <input type="checkbox" data-stat="saveProf" />
                    </div>
                  </div>
                </div>

                <div class="abilitySkills">
                  <div class="skillRow"><input type="checkbox" data-skill-prof="arcana" /><span>Arcana</span><span
                      data-skill-value="arcana">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="history" /><span>History</span><span
                      data-skill-value="history">+0</span></div>
                  <div class="skillRow"><input type="checkbox"
                      data-skill-prof="investigation" /><span>Investigation</span><span
                      data-skill-value="investigation">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="nature" /><span>Nature</span><span
                      data-skill-value="nature">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="religion" /><span>Religion</span><span
                      data-skill-value="religion">+0</span></div>
                </div>
              </div>

              <!-- WISDOM -->
              <div class="abilityBlock" data-ability="wis">
                <div class="abilityHeader">
                  <div class="abilityTitle">Wisdom</div>
                  <div class="abilityStats">
                    <input type="number" class="abilityScore" data-stat="score" />
                    <div class="abilityStat">Mod <span data-stat="mod">+0</span></div>
                    <div class="abilityStat">
                      Save <span data-stat="save">+0</span>
                      <input type="checkbox" data-stat="saveProf" />
                    </div>
                  </div>
                </div>

                <div class="abilitySkills">
                  <div class="skillRow"><input type="checkbox" data-skill-prof="animal" /><span>Animal
                      Handling</span><span data-skill-value="animal">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="insight" /><span>Insight</span><span
                      data-skill-value="insight">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="medicine" /><span>Medicine</span><span
                      data-skill-value="medicine">+0</span></div>
                  <div class="skillRow"><input type="checkbox"
                      data-skill-prof="perception" /><span>Perception</span><span
                      data-skill-value="perception">+0</span></div>
                  <div class="skillRow"><input type="checkbox" data-skill-prof="survival" /><span>Survival</span><span
                      data-skill-value="survival">+0</span></div>
                </div>
              </div>

              <!-- CHARISMA -->
              <div class="abilityBlock" data-ability="cha">
                <div class="abilityHeader">
                  <div class="abilityTitle">Charisma</div>
                  <div class="abilityStats">
                    <input type="number" class="abilityScore" data-stat="score" />
                    <div class="abilityStat">Mod <span data-stat="mod">+0</span></div>
                    <div class="abilityStat">
                      Save <span data-stat="save">+0</span>
                      <input type="checkbox" data-stat="saveProf" />
                    </div>
                  </div>
                </div>

                <div class="abilitySkills">
                  <div class="skillRow"><input type="checkbox" data-skill-prof="deception" /><span>Deception</span><span
                      data-skill-value="deception">+0</span></div>
                  <div class="skillRow"><input type="checkbox"
                      data-skill-prof="intimidation" /><span>Intimidation</span><span
                      data-skill-value="intimidation">+0</span></div>
                  <div class="skillRow"><input type="checkbox"
                      data-skill-prof="performance" /><span>Performance</span><span
                      data-skill-value="performance">+0</span></div>
                  <div class="skillRow"><input type="checkbox"
                      data-skill-prof="persuasion" /><span>Persuasion</span><span
                      data-skill-value="persuasion">+0</span></div>
                </div>
              </div>

            </div>
          </section>

          <section class="panel" id="charProfPanel">
            <h2 class="m0">Proficiencies & Languages</h2>
            <div class="fieldLabelRow">
              <div class="fieldLabel">Armor Proficiencies</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charArmorProf" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charArmorProf" data-persist-size placeholder="Armor proficiencies..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Weapon Proficiencies</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charWeaponProf" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charWeaponProf" data-persist-size placeholder="Weapon proficiencies..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Tool Proficiencies</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charToolProf" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charToolProf" data-persist-size placeholder="Tool proficiencies..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Languages</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charLanguages" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charLanguages" data-persist-size placeholder="Languages known..."></textarea>
          </section>

          <section class="panel" id="charAttacksPanel">
            <div class="row between items-center">
              <h2 class="m0">Weapons</h2>
              <button id="addAttackBtn" type="button" class="headerAddBtn" title="Add a new weapon">+ Weapon</button>
            </div>
            <div id="attackList" class="attackList"></div>
          </section>

          <section class="panel" id="charSpellsPanel">
            <div class="row between items-center">
              <h2 class="m0">Spells</h2>
              <button id="addSpellLevelBtn" type="button" class="headerAddBtn" title="Add spell level">+ Level</button>
            </div>

            <div id="spellLevels" class="spellLevels"></div>

            <div class="mutedSmall">Tip: each spell has its own notes box. Use the arrow on a
              spell to show/hide notes.</div>
          </section>

          <section class="panel" id="charEquipmentPanel">
            <h2 class="m0">Equipment</h2>
            <div class="fieldLabelRow">
              <div class="fieldLabel">Inventory</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charEquipment" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charEquipment" data-persist-size placeholder="Equipment, items, treasures..."></textarea>

            <div class="moneyRow">
              <div class="moneyTile">
                <div class="moneyLabel">GP</div><input id="moneyGP" type="number" placeholder="0" />
              </div>
              <div class="moneyTile">
                <div class="moneyLabel">SP</div><input id="moneySP" type="number" placeholder="0" />
              </div>
              <div class="moneyTile">
                <div class="moneyLabel">CP</div><input id="moneyCP" type="number" placeholder="0" />
              </div>
              <div class="moneyTile">
                <div class="moneyLabel">PP</div><input id="moneyPP" type="number" placeholder="0" />
              </div>
              <div class="moneyTile">
                <div class="moneyLabel">EP</div><input id="moneyEP" type="number" placeholder="0" />
              </div>
            </div>
          </section>

          <section class="panel" id="charPersonalityPanel">
            <h2 class="m0">Personality</h2>
            <div class="fieldLabelRow">
              <div class="fieldLabel">Traits</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charTraits" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charTraits" data-persist-size placeholder="Personality traits..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Ideals</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charIdeals" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charIdeals" data-persist-size placeholder="Ideals..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Bonds</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charBonds" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charBonds" data-persist-size placeholder="Bonds..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Flaws</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charFlaws" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charFlaws" data-persist-size placeholder="Flaws..."></textarea>

            <div class="fieldLabelRow">
              <div class="fieldLabel">Notes</div>
              <button type="button" class="panelCollapseBtn" data-collapse-target="charCharNotes" aria-expanded="true"
                title="Collapse/Expand">▾</button>
            </div>
            <textarea id="charCharNotes" data-persist-size placeholder="Anything else..."></textarea>
          </section>
        </div>
        <div class="charCol" id="charCol1"></div>
      </div>
    </section>


    <!-- MAP PAGE -->
    <section class="page" id="page-map">
      <section class="mapPanel">
        <div class="mapbar">
          <div class="maptools">
            <label class="mapSelectLabel">Map
              <select id="mapSelect" class="mapSelect" title="Choose a map"></select>
            </label>
            <button id="addMapBtn" title="Add a new map">+ Map</button>
            <button id="renameMapBtn" title="Rename selected map">Rename</button>
            <button id="deleteMapBtn" class="danger" title="Delete selected map">Delete</button>

          </div>
          <div class="maptools">
            <label class="brushSizeLabel">Size
              <input id="brushSize" type="range" min="1" max="32" value="6" />
            </label>

            <div class="dropdown" id="toolDropdown">
              <button type="button" class="mapToolDropDown" id="toolDropdownBtn" aria-haspopup="true"
                aria-expanded="false" title="Choose a tool">
                <span data-tool-label>Brush</span>
              </button>
              <div class="dropdownMenu" id="toolDropdownMenu" hidden>
                <button type="button" class="swatchOption" data-tool="brush">Brush</button>
                <button type="button" class="swatchOption" data-tool="eraser">Eraser</button>
              </div>
            </div>

            <div class="dropdown" id="colorDropdown">
              <button type="button" class="dropdownBtn" id="colorBtn" title="Brush color" aria-haspopup="true"
                aria-expanded="false">
                <span class="colorPreview" id="activeColorPreview"></span>
                <span class="caret">▾</span>
              </button>

              <div class="dropdownMenu colorGrid" id="colorDropdownMenu" hidden>
                <button class="colorSwatch" data-color="teal"></button>
                <button class="colorSwatch" data-color="red"></button>
                <button class="colorSwatch" data-color="blue"></button>

                <button class="colorSwatch" data-color="green"></button>
                <button class="colorSwatch" data-color="black"></button>
                <button class="colorSwatch" data-color="white"></button>

                <button class="colorSwatch" data-color="yellow"></button>
                <button class="colorSwatch" data-color="purple"></button>
                <button class="colorSwatch" data-color="grey"></button>
              </div>
            </div>

            <button id="undoBtn" class="warn">Undo</button>
            <button id="redoBtn" class="warn">Redo</button>
            <button id="clearMapBtn" class="danger">Clear Map</button>
          </div>

          <div class="maptools">
            <label class="filebtn">
              Set Map Image
              <input id="mapImageInput" type="file" accept="image/*" />
            </label>
            <button id="removeMapImageBtn">Remove Image</button>
          </div>
        </div>

        <div class="canvasWrap">
          <canvas id="mapCanvas" width="1200" height="800"></canvas>
        </div>

        <div class="mutedSmall">
          Tip: Draw with mouse/finger. Everything saves locally. (Undo/Redo are local too.)
        </div>
      </section>
    </section>
  </main>


  <!-- Data & Settings modal -->
  <div id="dataPanelOverlay" class="modalOverlay" hidden aria-hidden="true">
    <div class="modalPanel dataPanelPanel" id="dataPanelPanel" role="dialog" aria-modal="true"
      aria-labelledby="dataPanelTitle" tabindex="-1">
      <div class="dataPanelHeader">
        <div class="modalTitle" id="dataPanelTitle">Data &amp; Settings</div>
        <button type="button" class="npcSmallBtn" id="dataPanelClose" aria-label="Close">✕</button>
      </div>

      <div class="dataPanelSection">
        <div class="dataPanelLabel">Theme</div>
        <select id="dataPanelThemeSelect" class="settingsSelect" title="Theme"></select>
      </div>

      <div class="settingsDivider"></div>

      <div class="dataPanelSection">
        <div class="dataPanelLabel">Backups</div>
        <div class="dataPanelActions">
          <button id="dataExportBtn" class="settingsItem" type="button">Export Backup (.json)</button>

          <label class="settingsItem settingsFileItem" title="Import a previously exported backup">
            Import Backup
            <input id="dataImportFile" type="file" accept="application/json" />
          </label>
        </div>
      </div>

      <div class="settingsDivider"></div>

      <div class="dataPanelSection">
        <div class="dataPanelLabel">Maintenance</div>
        <div class="mutedSmall">These options affect data stored in your browser on this device.</div>
        <div class="dataPanelActions">
          <button id="dataResetUiBtn" class="settingsItem" type="button">Reset UI Only</button>
          <button id="dataClearImagesBtn" class="settingsItem" type="button">Clear Images Only</button>
          <button id="dataClearTextsBtn" class="settingsItem" type="button">Clear Text Notes Only</button>
          <button id="dataAboutBtn" class="settingsItem" type="button">About</button>
        </div>
      </div>

      <div class="settingsDivider"></div>

      <div class="dataPanelSection">
        <div class="dataPanelLabel dangerLabel">Danger Zone</div>
        <button class="settingsItem danger" id="dataResetAllBtn" type="button">Reset Everything</button>
        <div class="mutedSmall">This clears campaign data + images + notes from this browser.</div>
      </div>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>

</html>