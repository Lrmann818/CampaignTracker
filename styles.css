/* ======================
   Base + Theme
   ====================== */

:root {
  --bg: #0A0A0A;
  --panel: #121212;
  --card: linear-gradient(to bottom,
      rgba(255, 255, 255, 0.06),
      rgba(255, 255, 255, 0.0));
  --collapsedCard: linear-gradient(to bottom,
      rgba(255, 255, 255, 0.12),
      rgba(255, 255, 255, 0.0177));
  --frame-fill: color-mix(in srgb, var(--border) 60%, transparent);
  --text: #f0f0f0;
  --muted: #b9b9b9;
  --border: #404040;

  --surface-2: #141414;
  /* inputs */
  --surface-3: #151515;
  /* buttons/tabs */
  --surface-3-hover: #222;
  /* hover/active */
  --ring: #ffffff22;
  --hairline: #ffffff14;
  --shadow-inset: #00000055;
  --shadow-drop: #00000066;

  --map-empty: #0f0f0f;

  /* Unchanging Colors? */

  --spell-toggle-bg: var(--surface-3);
  --spell-toggle-on-border: var(--ring);
  --divider: var(--hairline);
  --divider-inset: var(--shadow-inset);
  --warn: #FF8C00;
  --warn-border: #ff8c0059;
  --warn-hover: #ff8c001f;
  --danger: #ff5a5a;
  --danger-border: #ff5a5a59;
  --danger-hover: #ff5a5a1f;
  --swatch-color-preview: #ffffff55;
  --swatch-color-active-border: #ffffff33;
  --color-swatch-border: #ffffff2e;
  --color-swatch-hover: #ffffff59;
  --spell-toggle-warn-on-border: #ff8c0099;
  --skill-prof-dot: #3aa6ff;

  /* unchanging variables can go here */
  --portrait-ratio: 3 / 4; /* width / height   matches character portrait */
  --tracker-list-max: 720px;
}

/* Light theme */
:root[data-theme="light"] {
  --bg: #f5f5f7;
  --panel: #ffffff;
  --card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0.1));
  --collapsedCard: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.0),
      rgba(0, 0, 0, 0.02));
  --spell-card: linear-gradient(to bottom,
      rgba(0, 0, 0, .1),
      rgba(0, 0, 0, 0.15));

  --text: #1a1a1a;
  --muted: #555;
  --border: #d0d0d6;

  --surface-2: #f0f0f3;
  /* inputs */
  --surface-3: #e8e8ee;
  /* buttons/tabs */
  --surface-3-hover: #dadbe3;
  /* hover/active */

  --ring: #0000001f;
  --hairline: #00000052;
  --shadow-inset: #0000000f;
  --shadow-drop: #0000001f;

  --map-empty: #e9e9ee;
}

/* Purple theme */
:root[data-theme="purple"] {
  --bg: #391E54;
  --panel: #4A3062;
  --card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0.2));
  --collapsedCard: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.0),
      rgba(0, 0, 0, 0.085));
  --spell-card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.2),
      rgba(0, 0, 0, 0.25));

  --text: #f3efff;
  --muted: #c3b6dd;
  --border: #332146;

  --surface-2: #402758;
  /* inputs */
  --surface-3: #3B2450;
  /* buttons/tabs */
  --surface-3-hover: #352148;
  /* hover/active */

  --ring: #e6d4ff38;
  --hairline: #e6d4ff1f;
  --shadow-inset: #0000008c;
  --shadow-drop: #000000a8;

  --map-empty: #100a18;
}

/* Teal theme */
:root[data-theme="teal"] {
  --bg: #8fbab4;
  /* warmer deep turquoise backdrop */
  --panel: #b2d4cf;
  /* card surface */
  --text: #0a2421;
  --muted: #355b56;
  --border: #5e9a90;
  --card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0.2));
  --collapsedCard: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.0),
      rgba(0, 0, 0, 0.085));
  --spell-card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.2),
      rgba(0, 0, 0, 0.25));

  --surface-2: #a6c9c3;
  /* inputs */
  --surface-3: #96beb6;
  /* buttons/tabs */
  --surface-3-hover: #86b2a9;

  --ring: rgba(35, 135, 115, 0.42);
  --hairline: rgba(35, 135, 115, 0.30);
  --shadow-inset: rgba(0, 0, 0, 0.18);
  --shadow-drop: rgba(0, 0, 0, 0.38);

  --map-empty: #7ea8a1;
}

/* Green theme */
:root[data-theme="green"] {
  --bg: #091a07;
  /* darker toxic green-black */
  --panel: #0e2b0a;
  /* deepened core surface */
  --text: #e9ffe3;
  --muted: #97cf8d;
  --border: #1c5315;
  /* darker cousin of #0E6605 */

  --surface-2: #123c0f;
  /* inputs */
  --surface-3: #174e13;
  /* buttons/tabs */
  --surface-3-hover: #1e6618;
  /* toxic lift */

  /* Toxic glow accents */
  --ring: rgba(70, 200, 60, 0.38);
  --hairline: rgba(70, 200, 60, 0.24);

  --shadow-inset: rgba(0, 0, 0, 0.65);
  --shadow-drop: rgba(0, 0, 0, 0.82);

  --map-empty: #050f04;
}

/* Blue theme */
:root[data-theme="blue"] {
  --bg: #c7f2f7;
  /* pale cyan backdrop */
  --panel: #e3f9fc;
  /* light blue-glass panels */
  --text: #0b2a30;
  --muted: #4f6f75;
  --card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0.15));
  --collapsedCard: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.0),
      rgba(0, 0, 0, 0.039));
  --spell-card: linear-gradient(to bottom,
      rgba(0, 0, 0, .1),
      rgba(0, 0, 0, 0.15));

  /* Steel / iron structure */
  --border: #9fb7bd;

  --surface-2: #d6eef3;
  /* inputs */
  --surface-3: #c4e6ec;
  /* buttons/tabs */
  --surface-3-hover: #b2dbe2;

  /* Cyan focus with steel restraint */
  --ring: rgba(0, 180, 200, 0.34);
  --hairline: rgba(120, 140, 150, 0.22);

  --shadow-inset: rgba(0, 0, 0, 0.10);
  --shadow-drop: rgba(0, 0, 0, 0.26);

  --map-empty: #b8dde3;
}

/* Red theme */
:root[data-theme="red"] {
  --bg: #2a0f12;
  --panel: #3a1519;
  --text: #ffecec;
  --muted: #e0b3b3;
  --border: #6a2a2f;

  --surface-2: #451a1f;
  --surface-3: #4f2026;
  --surface-3-hover: #612a31;

  --ring: rgba(255, 120, 120, 0.22);
  --hairline: rgba(255, 120, 120, 0.14);
  --shadow-inset: rgba(0, 0, 0, 0.45);
  --shadow-drop: rgba(0, 0, 0, 0.7);

  --map-empty: #160708;
}

:root[data-theme="red-gold"] {
  --bg: #2a0f12;
  --panel: #3a1519;
  --text: #ffecec;
  --muted: #e0b3b3;
  --border: #7a6738;

  --surface-2: #451a1f;
  --surface-3: #4f2026;
  --surface-3-hover: #612a31;

  --ring: rgba(255, 205, 120, 0.55);
  --hairline: rgba(255, 200, 95, 0.35);
  --shadow-inset: rgba(0, 0, 0, 0.45);
  --shadow-drop: rgba(0, 0, 0, 0.7);

  --map-empty: #160708;
}

/* Rose theme */
:root[data-theme="rose"] {
  --bg: #f2d6df;
  /* soft blush background */
  --panel: #f8e6ec;
  /* light rose panels */
  --text: #3a1f2b;
  --muted: #7a4a5a;
  --border: #d4a3b4;
  --card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0.15));
  --collapsedCard: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.0),
      rgba(0, 0, 0, 0.039));
  --spell-card: linear-gradient(to bottom,
      rgba(0, 0, 0, .1),
      rgba(0, 0, 0, 0.15));

  --surface-2: #f1d7df;
  /* inputs */
  --surface-3: #e8c6d0;
  /* buttons/tabs */
  --surface-3-hover: #ddb5c2;

  --ring: rgba(180, 90, 120, 0.32);
  --hairline: rgba(180, 90, 120, 0.20);
  --shadow-inset: rgba(0, 0, 0, 0.10);
  --shadow-drop: rgba(0, 0, 0, 0.28);

  --map-empty: #e6bcc9;
}

/* Beige theme */
:root[data-theme="beige"] {
  --bg: #c3b596;
  /* warmer, slightly darker backdrop */
  --panel: #d6c7a9;
  /* parchment surface */
  --text: #221a11;
  --muted: #4b4030;
  --border: #9a8a6b;
  --card: linear-gradient(to bottom,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, 0.15));
  --collapsedCard: linear-gradient(to bottom,
      rgba(0, 0, 0, 0.0),
      rgba(0, 0, 0, 0.039));
  --spell-card: linear-gradient(to bottom,
      rgba(0, 0, 0, .1),
      rgba(0, 0, 0, 0.15));

  --surface-2: #ccbda0;
  /* inputs */
  --surface-3: #c0b191;
  /* buttons/tabs */
  --surface-3-hover: #b4a47f;

  --ring: rgba(96, 67, 28, 0.38);
  --hairline: rgba(96, 67, 28, 0.26);
  --shadow-inset: rgba(0, 0, 0, 0.18);
  --shadow-drop: rgba(0, 0, 0, 0.38);

  --map-empty: #b3a483;
}

/* Slate theme */
:root[data-theme="slate"] {
  --bg: #1c1f22;
  --panel: #24282c;
  --text: #e6e8ea;
  --muted: #a6abb0;
  --border: #3a4046;

  --surface-2: #2a2f34;
  --surface-3: #30363c;
  --surface-3-hover: #3a4148;

  --ring: rgba(180, 190, 200, 0.20);
  --hairline: rgba(180, 190, 200, 0.12);
  --shadow-inset: rgba(0, 0, 0, 0.45);
  --shadow-drop: rgba(0, 0, 0, 0.65);

  --map-empty: #16191c;
}

/* Forest theme */
:root[data-theme="forest"] {
  --bg: #0f1a13;
  --panel: #16241b;
  --text: #e9f3ec;
  --muted: #a9c2b2;
  --border: #2d4637;

  --surface-2: #1c3024;
  --surface-3: #223a2b;
  --surface-3-hover: #2a4a36;

  --ring: rgba(110, 170, 130, 0.22);
  --hairline: rgba(110, 170, 130, 0.14);
  --shadow-inset: rgba(0, 0, 0, 0.55);
  --shadow-drop: rgba(0, 0, 0, 0.75);

  --map-empty: #0a120d;
}

/* Ember theme */
:root[data-theme="ember"] {
  --bg: #1e120c;
  --panel: #2a1912;
  --text: #fff0e6;
  --muted: #d0a88e;
  --border: #6a3a22;

  --surface-2: #332017;
  --surface-3: #3d261c;
  --surface-3-hover: #4a2f23;

  --ring: rgba(255, 140, 80, 0.28);
  --hairline: rgba(255, 140, 80, 0.18);
  --shadow-inset: rgba(0, 0, 0, 0.55);
  --shadow-drop: rgba(0, 0, 0, 0.75);

  --map-empty: #120805;
}

/* Sepia theme */
:root[data-theme="sepia"] {
  --bg: #2a231b;
  --panel: #342c22;
  --text: #f3eadc;
  --muted: #c2b19a;
  --border: #5c4d3b;

  --surface-2: #3d3328;
  --surface-3: #463b2e;
  --surface-3-hover: #524536;

  --ring: rgba(190, 160, 110, 0.26);
  --hairline: rgba(190, 160, 110, 0.16);
  --shadow-inset: rgba(0, 0, 0, 0.55);
  --shadow-drop: rgba(0, 0, 0, 0.75);

  --map-empty: #1b160f;
}

/* Arcane theme */
:root[data-theme="arcane"] {
  --bg: #14112a;
  /* deep arcane void */
  --panel: #1d1a3a;
  /* spell-slate panels */
  --text: #f0ecff;
  --muted: #b7b0e0;
  --border: #3c3670;

  --surface-2: #24204a;
  /* inputs */
  --surface-3: #2b2660;
  /* buttons/tabs */
  --surface-3-hover: #362f78;

  --ring: rgba(155, 140, 255, 0.32);
  --hairline: rgba(155, 140, 255, 0.20);
  --shadow-inset: rgba(0, 0, 0, 0.55);
  --shadow-drop: rgba(0, 0, 0, 0.75);

  --map-empty: #0b0a1a;
}

/* Arcane Gold theme */
:root[data-theme="arcane-gold"] {
  --bg: #120f24;
  /* arcane void */
  --panel: #1b1634;
  /* spell-slate panels */
  --text: #f6f2ff;
  --muted: #cfc6ee;

  /* Violet structure with gold influence */
  --border: #7a6738;

  --surface-2: #231e44;
  /* inputs */
  --surface-3: #2b2554;
  /* buttons/tabs */
  --surface-3-hover: #382f6a;

  /* Gold rune accents (now unmistakable) */
  --ring: rgba(255, 205, 120, 0.55);
  --hairline: rgba(255, 200, 95, 0.35);

  /* Shadows stay dark so gold pops */
  --shadow-inset: rgba(0, 0, 0, 0.6);
  --shadow-drop: rgba(0, 0, 0, 0.8);

  --map-empty: #0a0916;
}

/* ______ theme (theme template - fill in and uncomment)

:root[data-theme="______"] {
  --bg: #______;
  --panel: #______;
  --card: linear-gradient(
    to bottom,
    rgba(0,0,0,0),                           /* change these as needed
    rgba(0,0,0,0.1)                          /* change these as needed
  );
  --collapsedCard: linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.12),               /* change these as needed
    rgba(255, 255, 255, 0.0177)              /* change these as needed
  );

  --text: #______;
  --muted: #______;
  --border: #______;

  --surface-2: #______;
  --surface-3: #______;
  --surface-3-hover: #______;

  --ring: rgba(_,_,_,0.12);
  --hairline: rgba(_,_,_,0.10);
  --shadow-inset: rgba(_,_,_,0.06);
  --shadow-drop: rgba(_,_,_,0.12);

  --map-empty: #______;
} */

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.topbar {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  border-bottom: 1px solid var(--border);
  background: var(--panel);
}

.titlewrap {
  min-width: 0;
}

#campaignTitle {
  margin: 0;
  font-size: 20px;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.titleRow{
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0; /* allows ellipsis to work */
}

#campaignTitle{
  min-width: 0;
  flex: 1 1 auto; /* title shrinks first, clock stays visible */
}

/* Clock matches the same border/surface language as .tab/buttons */
.clockChip{
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  border-radius: 10px;
  padding: 8px 10px;
  font-size: 14px;
  font-weight: 500;
  line-height: 1;
  font-variant-numeric: tabular-nums; /* stable-width digits */
}

.clockChip:hover{
  background: var(--surface-3-hover);
}

/* Optional: hide clock on *very* small widths if it ever crowds */
@media (max-width: 420px){
  .clockChip{ display:none; }
}

.topbarCenter{
  flex: 1 1 auto;
  display: flex;
  justify-content: flex-end;
}

.muted {
  color: var(--muted);
}

.small {
  font-size: 12px;
}

.tabs {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.tab {
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  padding: 8px 10px;
  border-radius: 10px;
}

.tab.active {
  outline: 2px solid var(--ring);
  background: var(--surface-3-hover);
}

main {
  padding: 14px;
}

.page {
  display: none;
}

.page.active {
  display: block;
}

.panel {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  box-shadow:
    0 6px 16px var(--shadow-inset);
}

.mapPanel {
  background: var(--card);
  /* map panel background */
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  box-shadow:
    0 0 0 1px var(--shadow-inset) inset,
    0 6px 16px var(--shadow-drop);
}

.grid2 {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .grid2 {
    grid-template-columns: 1fr;
  }
}

textarea {
  width: 100%;
  min-height: 140px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 10px;
  resize: vertical;
}

input {
  width: 100%;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 10px;
}

/* Match all text fields site-wide */
input,
textarea {
  font: inherit;
}

.row {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

/* Small utility helpers (used in HTML) */
.between {
  justify-content: space-between;
}

.items-center {
  align-items: center;
}

.items-end {
  align-items: flex-end;
}

.m0 {
  margin: 0;
}

button,
.filebtn {
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  padding: 9px 10px;
  border-radius: 10px;
  cursor: pointer;
}

button:hover,
.filebtn:hover {
  background: var(--surface-3-hover);
}

button.danger {
  border-color: var(--danger-border);
  color: var(--danger);
}

button.danger:hover {
  background: var(--danger-hover);
}

button.warn {
  border-color: var(--warn-border);
  color: var(--warn);
}

button.warn:hover {
  background: var(--warn-hover);
}

.filebtn input {
  display: none;
}

.mapbar {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.maptools {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.mapSelectLabel {
  display: flex;
  gap: 6px;
  align-items: center;
}

.mapSelect {
  min-width: 160px;
  max-width: 240px;
}

.chip {
  padding: 8px 10px;
  border-radius: 999px;
}

.chip.active {
  outline: 2px solid var(--ring);
  background: var(--surface-3-hover);
}

.mutedSmall {
  padding-top: 8px;
  font-size: 12px;
}

.topbarRight {
  display: flex;
  gap: 8px;
  align-items: center;
}

/* Generic dropdown */
.settingsDropdown {
  position: relative;
}

.settingsBtn {
  white-space: nowrap;
}

.settingsMenu {
  position: absolute;
  right: 0;
  top: calc(100% + 8px);
  min-width: 240px;
  z-index: 999;

  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;

  box-shadow:
    0 0 0 1px var(--shadow-inset) inset,
    0 10px 22px var(--shadow-drop);
}

.settingsSection {
  display: grid;
  gap: 6px;
  padding: 4px 2px 10px;
}

.settingsLabel {
  font-size: 12px;
  color: var(--muted);
}

.settingsSelect {
  width: 100%;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 36px 9px 10px;
  /* room for arrow */
  border-radius: 10px;
  font: inherit;

  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%),
    linear-gradient(to right, transparent, transparent);
  background-position:
    calc(100% - 18px) 55%,
    calc(100% - 12px) 55%,
    0 0;
  background-size:
    6px 6px,
    6px 6px,
    100% 100%;
  background-repeat: no-repeat;
}

.settingsSelect:focus {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

.settingsDivider {
  height: 1px;
  background: var(--border);
  margin: 10px 0;
}

.settingsItem {
  width: 100%;
  text-align: left;
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  border-radius: 10px;
  padding: 8px 10px;
  margin: 6px 0;
  cursor: pointer;
}

.settingsItem:hover {
  background: var(--surface-3-hover);
}

.settingsItem.danger {
  border-color: var(--danger);
  color: var(--danger);
}

/* Make the Import label look like a button */
.settingsFileItem {
  display: block;
}

.settingsFileItem input[type="file"] {
  display: none;
}

/* ======================
   Map Page
   ====================== */

/* --- Map: tool + color dropdowns --- */
.dropdown {
  position: relative;
  display: inline-block;
}

.dropdownBtn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.dropdownBtn .caret {
  opacity: 0.85;
}

.dropdownMenu {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  z-index: 50;
  min-width: 170px;
  padding: 6px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--panel);
  box-shadow: 0 12px 28px var(--shadow-drop);
}

.swatchOption {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text);
  cursor: pointer;
  text-align: left;
}

.swatchOption:hover {
  background: var(--surface-3-hover);
  border-color: var(--hairline);
}

.swatchOption.active {
  outline: 2px solid var(--ring);
  background: var(--surface-3-hover);
}

.colorSwatch[data-color="teal"] {
  --swatch-color: #35d0d6;
}

.colorSwatch[data-color="red"] {
  --swatch-color: #e04b4b;
}

.colorSwatch[data-color="blue"] {
  --swatch-color: #3aa6ff;
}

.colorSwatch[data-color="green"] {
  --swatch-color: #34c97b;
}

.colorSwatch[data-color="black"] {
  --swatch-color: #111111;
}

.colorSwatch[data-color="white"] {
  --swatch-color: #f0f0f0;
}

.colorSwatch[data-color="yellow"] {
  --swatch-color: #f2c94c;
}

.colorSwatch[data-color="purple"] {
  --swatch-color: #9b7bff;
}

.colorSwatch[data-color="grey"] {
  --swatch-color: #8c8c8c;
}

/* De-emphasize color control when eraser is selected */
.dropdown.disabled {
  opacity: 0.55;
}

.dropdown.disabled .dropdownBtn {
  cursor: not-allowed;
}

.dropdown.disabled .dropdownBtn:hover {
  background: var(--surface-3);
}

/* --- Color grid dropdown --- */
.colorGrid {
  display: grid;
  grid-template-columns: repeat(3, 36px);
  gap: 10px;
  padding: 12px;

  justify-content: center;
  align-content: center;
}

.colorSwatch {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  border: 1px solid var(--color-swatch-border);
  background: var(--swatch-color);
  box-sizing: border-box;
  transition:
    transform 0.12s ease,
    border-color 0.12s ease,
    box-shadow 0.12s ease;
}

.colorSwatch:hover {
  transform: scale(1.08);
  border-color: var(--color-swatch-hover);
}

.colorSwatch.active {
  border-color: white;
  box-shadow: 0 0 0 2px var(--swatch-color-active-border);
}

/* Preview circle in the button */
.colorPreview {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--swatch-color);
  border: 1px solid var(--swatch-color-preview);
}

.canvasWrap {
  width: 100%;
  overflow: auto;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--card);
  /* canvas background */
  box-shadow:
    0 0 0 1px var(--shadow-inset) inset,
    0 6px 16px var(--shadow-drop);
  touch-action: none;
  /* important for touch drawing */
}

#mapCanvas {
  display: block;
  max-width: none;
}

/* Make the HTML `hidden` attribute always win (fix stuck-open dropdowns) */
.dropdownMenu[hidden] {
  display: none !important;
}

/* Make Map dropdown match the styled selects */
select.mapSelect {
  width: auto;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 36px 9px 10px;
  /* space for arrow */
  border-radius: 10px;
  font: inherit;

  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  /* custom arrow */
  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%),
    linear-gradient(to right, transparent, transparent);
  background-position:
    calc(100% - 18px) 55%,
    calc(100% - 12px) 55%,
    0 0;
  background-size:
    6px 6px,
    6px 6px,
    100% 100%;
  background-repeat: no-repeat;
}

select.mapSelect:focus {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

/* ======================
   Tracker Page (Sessions / NPCs / Party / Locations)
   ====================== */

.sessionHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.sessionControls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.sessionTabsWrap {
  border: 1px solid var(--border);
  background: var(--surface-2);
  border-radius: 12px;
  padding: 8px;
  margin-bottom: 10px;
  overflow: auto;
}

.sessionTabs {
  display: flex;
  gap: 8px;
  align-items: center;
  width: max-content;
  /* so it scrolls horizontally on mobile */
}

.sessionTab {
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  padding: 8px 10px;
  border-radius: 999px;
  cursor: pointer;
  white-space: nowrap;
}

.sessionTab.active {
  outline: 2px solid var(--ring);
  background: var(--surface-3-hover);
}

.sessionSearch {
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 10px;
  border-radius: 10px;
  min-width: 180px;
  width: auto;
}

/* NPC Panel */
.npcHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.npcControls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.npcSearch {
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 10px;
  border-radius: 10px;
  min-width: 180px;
  width: auto;
}

.npcTabsWrap {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

.npcTab {
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  padding: 8px 10px;
  border-radius: 999px;
  cursor: pointer;
}

.npcTab.active {
  outline: 2px solid var(--ring);
  background: var(--surface-3-hover);
}

.npcCards {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

.npcCard {
  position: relative;
  /* anchors ::after */
  border: 2px solid var(--border);
  /* the frame */
  border-radius: 16px;
  overflow: hidden;
  /* clips image to the frame */
  background: var(--card);
  /* npc card background */
  isolation: isolate;
  /* prevents shadow bleeding */
  box-shadow:
    0 6px 16px var(--shadow-drop);
}

/* Drop shadow layer (outside, clipped) */
.npcCard::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 14px;
  pointer-events: none;
  z-index: 2;
  box-shadow: inset 0 0 0 5.5px var(--frame-fill);
}

.npcCard::after {
  content: "";
  position: absolute;
  inset: 5px;
  border: 1px solid var(--hairline);
  border-radius: 10px;
  pointer-events: none;
  z-index: 3;
}

.npcCard.collapsed {
  background: var(--collapsedCard);
  /* collapsed card background */
}

@media (max-width: 600px) {
  .npcCards {
    grid-template-columns: 1fr;
  }
}

/* PARTY Panel (same vibe as NPC panel, but no group tabs) */
.partyHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.partyControls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.partySearch {
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 10px;
  border-radius: 10px;
  min-width: 180px;
  width: auto;
}

.partyCards {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .partyCards {
    grid-template-columns: 1fr;
  }
}

.locHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.locControls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.locSearch {
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 10px;
  border-radius: 10px;
  min-width: 180px;
  width: auto;
}

.locFilter {
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 10px;
  border-radius: 10px;
}

.locCards {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .locCards {
    grid-template-columns: 1fr;
  }
}

/* Make select boxes match your textbox style (closed state) */

select.npcField {
  width: 100%;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 9px 36px 9px 10px;
  /* space for arrow */
  border-radius: 10px;
  font: inherit;

  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  /* custom arrow */
  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%),
    linear-gradient(to right, transparent, transparent);
  background-position:
    calc(100% - 18px) 55%,
    calc(100% - 12px) 55%,
    0 0;
  background-size:
    6px 6px,
    6px 6px,
    100% 100%;
  background-repeat: no-repeat;
}

select.npcField:focus {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

/* --- NPC Card: stacked layout --- */
.npcCardStack {
  display: flex;
  flex-direction: column;
}

.npcPortraitTop {
  width: 100%;
  height: 160px;
  background: var(--map-empty);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  cursor: pointer;
  position: relative;
}

/* Full-area overlay button used for NPC/Party/Character portraits */
.npcPortraitBtn {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  background: transparent;
  border: 0;
  color: var(--muted);
  font: inherit;
  font-weight: 600;
  letter-spacing: 0.2px;
  cursor: pointer;
  z-index: 1; /* above the image, below card frame pseudo-elements */
}

.npcPortraitBtn:hover {
  color: var(--text);
  background: color-mix(in srgb, var(--surface-3-hover) 35%, transparent);
}

.npcPortraitBtn:focus {
  outline: none;
}

.npcPortraitTop img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center-top;
  display: block;
}

.npcCardBodyStack {
  padding: 12px;
  display: grid;
  gap: 10px;
}

/* Collapsible card header (name + toggle) */
.npcHeaderRow {
  display: flex;
  align-items: center;
  gap: 8px;
}

.npcHeaderRow .npcField {
  flex: 1;
}

.npcCollapseToggle {
  flex: 0 0 auto;
  width: 34px;
  height: 34px;
  display: grid;
  place-items: center;
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--muted);
  border-radius: 10px;
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

.npcCollapseToggle:hover {
  color: var(--text);
  background: var(--surface-3-hover);
}

.npcCollapsible {
  display: grid;
  gap: 10px;
}

/* Make sure the HTML `hidden` attribute actually hides things */
.npcCollapsible[hidden],
.npcCardFooter[hidden] {
  display: none !important;
}

.npcNameBig {
  font-size: 18px;
  font-weight: 800;
}

.npcClass {
  opacity: 0.95;
}

.npcMiniLabel {
  font-size: 12px;
  color: var(--muted);
  margin: 0 0 6px 2px;
}

.npcHpRow {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 10px;
}

.npcHpInput {
  width: 78px;
  text-align: center;
  padding: 8px 10px;
  /* slightly tighter */
  flex: 0 0 auto;
  /* prevents stretching in flex layouts */
  min-width: 70px;
  max-width: 70px;
}

.npcBlock {
  display: grid;
  gap: 6px;
}

/* Notes: fixed height + internal scroll (like your sketch) */
.npcNotesBox {
  min-height: 110px;
  max-height: 110px;
  overflow: auto;
  resize: none;
}

/* Footer actions separated from "in-world" content */
.npcCardFooter {
  padding: 10px 12px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  background: var(--card);
}

.npcField {
  /* Use the same style as other inputs */
  width: 100%;
}

.npcTextarea {
  width: 100%;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text);
  padding: 10px;
  resize: vertical;
}

#npcCards, #partyCards, #locCards{
  max-height: var(--tracker-list-max);
  overflow-y: auto;
  overflow-x: hidden;

  /* prevents weird “stretching/squishing” behavior in some layouts */
  align-content: start;
  grid-auto-rows: max-content;

  padding-right: 4px; /* small gutter so scrollbar isn't tight to the edge */
}

/* mobile: use a viewport-based cap */
@media (max-width: 600px){
  :root{ --tracker-list-max: 78vh; }
}

/* ======================
   Character Sheet Page
   ====================== */


.charBasicsGrid {
  display: grid;
  gap: 10px;
  margin-top: 10px;

  align-content: start;     /* prevents “stretch rows to fill height” */
  align-items: start;       /* keeps items from stretching vertically */
  grid-auto-rows: max-content; /* ensures rows size to content */
}

.charTwo {
  display: grid;
  gap: 10px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .charTwo {
    grid-template-columns: 1fr;
  }
}

.charTiles {
  display: grid;
  gap: 10px;
  grid-template-columns: repeat(3, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .charTiles {
    grid-template-columns: 1fr;
  }
}

/* Vitals tile header (for reordering controls) */
.vitalHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}

.vitalHeader .charTileLabel {
  margin: 0;
}

.fieldLabel {
  font-size: 16px;
  color: var(--muted);
  margin: 4px 0 4px 2px;
  letter-spacing: 0.02em;
}

.vitalMoves {
  display: flex;
  gap: 6px;
  align-items: center;
}

.charTile {
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 10px;
  background: var(--card);
  /* vitals tile background */
  box-shadow: 0 6px 16px var(--shadow-drop);
  display: grid;
  gap: 8px;
}


.charTileLabel {
  font-size: 12px;
  color: var(--muted);
  margin-left: 2px;
}

.charHpRow {
  display: flex;
  gap: 8px;
  align-items: center;
}

.charHpRow input {
  width: 78px;
  text-align: center;
  padding: 8px 10px;
  /* slightly tighter */
  flex: 0 0 auto;
  /* prevents stretching in flex layouts */
  min-width: 70px;
  max-width: 70px;
}

.resourceHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

.iconBtn {
  padding: 6px 8px;
  border-radius: 10px;
  line-height: 1;
}


/* --- Attacks --- */
.attackList {
  display: grid;
  gap: 10px;
  margin-top: 10px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .attackList {
    grid-template-columns: 1fr;
  }
}

.attackRow {
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 10px;

  display: grid;
  gap: 10px;

  background: var(--card);
  /* attack card background */

  /* 2 columns for fields + 1 skinny column for actions */
  grid-template-columns: 1fr 1fr auto;
  grid-template-rows: auto auto auto;
  align-items: start;

  box-shadow: 0 6px 16px var(--shadow-drop);
}

/* Each row has TWO inputs, so make it 2 columns and span the left side */
.attackTop,
.attackMiddle,
.attackBottom {
  grid-column: 1 / span 2;
  display: grid;
  gap: 10px;
  grid-template-columns: 1fr 1fr;
}

/* This is the “yellow circle pocket” column */
.attackActions {
  grid-column: 3;
  grid-row: 1 / span 3;
  align-self: stretch;

  display: flex;
  align-items: flex-end;
  justify-content: flex-end;
}

/* make sure Delete is not absolutely positioned */
.attackActions .danger {
  position: static;
}

@media (max-width: 600px) {
  .attackRow {
    grid-template-columns: 1fr;
    grid-template-rows: auto;
  }

  .attackTop,
  .attackMiddle,
  .attackBottom {
    grid-column: 1;
    grid-template-columns: 1fr;
  }

  .attackActions {
    grid-column: 1;
    grid-row: auto;
    justify-content: flex-end;
  }
}

.moneyRow {
  display: grid;
  gap: 10px;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  margin-top: 10px;
}

@media (max-width: 600px) {
  .moneyRow {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

.moneyTile {
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 10px;
  background: var(--card);
  /* currency background */
  box-shadow: 0 6px 16px var(--shadow-drop);
  display: grid;
  gap: 6px;
  text-align: center;
}

.moneyLabel {
  font-weight: 800;
  letter-spacing: 0.04em;
  color: var(--text);
}

.moneyTile input {
  text-align: center;
}

.abilityGrid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}

@media (max-width: 600px) {
  .abilityGrid {
    grid-template-columns: 1fr;
  }
}

.abilityBlock {
  border: 2px solid var(--border);
  border-radius: 16px;
  background: var(--card);
  /* ability card background */
  box-shadow: 0 6px 16px var(--shadow-drop);
  overflow: hidden;
}

.abilityHeader {
  padding: 10px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  position: relative;
  /* anchors .abilityMoves */
}

.abilityTitle {
  font-weight: 700;
  margin-bottom: 6px;
}

.abilityStats {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 6px;
  align-items: center;
}

.abilityStats input {
  text-align: center;
}

.abilityStat {
  font-size: 12px;
  text-align: center;
}

.abilitySkills {
  padding: 10px;
}

.skillRow span:last-child {
  font-weight: 600;
}

.skillsGrid {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width: 600px) {
  .skillsGrid {
    grid-template-columns: 1fr;
  }
}

.skillBlock {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  background: var(--surface-2);
}

.skillHeader {
  font-weight: 700;
  margin-bottom: 8px;
}

.skillRow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 6px;
}

.skillRow span {
  font-size: 14px;
}

.skillRow input {
  width: 70px;
  text-align: center;
}

.skillRow input[type="checkbox"],
.abilityStat input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 1px solid var(--border);
  background: var(--surface-2);
  cursor: pointer;
}

.skillRow input[type="checkbox"]:checked,
.abilityStat input[type="checkbox"]:checked {
  background: var(--skill-prof-dot);
  border-color: var(--skill-prof-dot);
}

/* Panel header row (used for reorder controls on simple panels) */
.panelHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.sectionMoves {
  display: flex;
  gap: 6px;
  align-items: center;
}

.moveBtn {
  width: 30px;
  height: 30px;
  display: grid;
  place-items: center;
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--muted);
  border-radius: 10px;
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

.moveBtn:hover {
  color: var(--text);
  background: var(--surface-3-hover);
}


.abilityMoves {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 6px;
}

/* Character portrait column layout */
.charBasicsLayout {
  display: grid;
  grid-template-columns: 220px minmax(0, 1fr);
  gap: 12px;
  margin-top: 10px;
  align-items: stretch;
}

.charPortraitCard {
  display: flex;
  flex-direction: column;
  align-self: stretch;
}

.charPortraitTop {
  flex: 1 1 auto;
  min-height: 320px;
  display: grid;
  place-items: center;
}

.portraitPlaceholder {
  pointer-events: none;
  color: var(--muted);
  font-weight: 700;
  letter-spacing: 0.02em;
  padding: 10px;
  text-align: center;
  opacity: 0.95;
}

/* Character portrait: if the image is showing, hide the placeholder text */
#charPortraitImg:not([hidden]) + #charPortraitPlaceholder {
  display: none;
}

.charPortraitTop img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center-top;
  display: block;
}

@media (max-width: 700px) {
  .charBasicsLayout {
    grid-template-columns: 1fr;
  }

  .charPortraitTop {
    min-height: 220px;
  }
}

/* ======================
   Image crop modal
   (used by cropImageModal in app.js)
   ====================== */

.modalOverlay {
  position: fixed;
  inset: 0;
  z-index: 5000;
  display: grid;
  place-items: center;
  padding: 18px;
  background: rgba(0, 0, 0, 0.72);
  backdrop-filter: blur(4px);
}

.modalPanel {
  width: min(720px, 100%);
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;
  box-shadow:
    0 0 0 1px var(--shadow-inset) inset,
    0 16px 40px var(--shadow-drop);
}

.modalTitle {
  font-weight: 700;
  margin: 4px 4px 10px;
}

.cropWrap {
  position: relative;
  width: 100%;
  aspect-ratio: var(--portrait-ratio);
  max-height: calc(100dvh - 240px);
  border-radius: 12px;
  overflow: hidden;
  background: var(--map-empty);
  border: 1px solid var(--hairline);
  margin-bottom: 10px;
}

.cropCanvas {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: contain;
  touch-action: none; /* allows drag on mobile without scrolling */
}

.cropFrame {
  position: absolute;
  inset: 0;
  pointer-events: none;
  box-shadow:
    0 0 0 2px var(--hairline) inset,
    0 0 0 999px rgba(0, 0, 0, 0.18) inset;
}

.modalControls {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 4px;
}

.modalLabel {
  color: var(--muted);
  font-size: 12px;
}

.modalRange {
  width: 100%;
}

.modalBtnRow {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  padding: 6px 4px 2px;
}

.modalBtn {
  border: 1px solid var(--border);
  background: var(--surface-3);
  color: var(--text);
  padding: 9px 12px;
  border-radius: 10px;
  cursor: pointer;
}

.modalBtn:hover {
  background: var(--surface-3-hover);
}

.modalBtnPrimary {
  outline: 2px solid var(--ring);
  outline-offset: 0;
}

/* Spells v2 */
.spellLevels {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

/* ======================
   Spells v2 (layout)
   ====================== */

.spellLevel {
  border: 2px solid var(--border);
  border-radius: 16px;
  background: var(--card);
  box-shadow: 0 6px 16px var(--shadow-drop);
  overflow: hidden;
}

.spellLevelHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  padding: 10px;
  position: relative;
  background: var(--card);
  /* spell level header background */
}

.spellLevelLeft {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

.spellLevelTitle {
  min-width: 0;
}

.spellLevelTitle input {
  width: min(520px, 55vw);
  max-width: 100%;
}

.spellLevelRight {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
  flex: 0 0 auto;
}

.spellSlots {
  display: flex;
  align-items: center;
  gap: 8px;
}

.spellSlots input {
  width: 72px;
  text-align: center;
  padding: 8px 10px;
  flex: 0 0 auto;
}

.spellLevelActions {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
  flex: 0 0 auto;
}

.spellCollapseBtn,
.spellSpellCollapseBtn {
  padding: 6px 10px;
  border-radius: 12px;
  line-height: 1;
  flex: 0 0 auto;
}

.spellBody {
  padding: 10px 10px 10px;
  position: relative;
  background: var(--spell-card);
  /* spell level body background */
}

.spellBody::before {
  content: "";
  display: block;
  height: 2px;
  background: var(--divider);
  margin-bottom: 10px;
}

/* If collapsed via [hidden], divider disappears automatically */
.spellBody[hidden]::before {
  display: none;
}

.spellRow {
  border-top: 2px solid var(--divider);
  padding-top: 10px;
  margin-top: 10px;
}

.spellRow:first-child {
  border-top: none;
  padding-top: 0;
  margin-top: 0;
}

.spellRowTop {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

.spellName {
  flex: 1 1 auto;
  min-width: 0;
}

.spellToggles {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 0 0 auto;
}

.spellToggle {
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: var(--spell-toggle-bg);
  color: var(--text);
  line-height: 1;
}

.spellToggle.on {
  border-color: var(--spell-toggle-on-border);
  box-shadow: 0 0 0 1px var(--shadow-inset) inset;
}

.spellToggle.warn.on {
  border-color: var(--spell-toggle-warn-on-border);
}

.spellMiniBtns {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 0 0 auto;
}

.spellMoveBtn {
  padding: 6px 10px;
  border-radius: 12px;
  line-height: 1;
}

.spellNotes {
  margin-top: 10px;
}

.spellNotes textarea {
  width: 100%;
}

@media (max-width: 600px) {
  .spellLevelHeader {
    flex-wrap: wrap;
    align-items: flex-start;
  }

  .spellLevelTitle input {
    width: 100%;
  }

  .spellLevelRight {
    width: 100%;
    justify-content: flex-end;
    flex-wrap: wrap;
  }

  .spellRowTop {
    flex-wrap: wrap;
  }

  .spellToggles,
  .spellMiniBtns {
    flex-wrap: wrap;
  }
}

/* Spells v2: fix inputs forcing buttons to wrap on desktop */
@media (min-width: 601px) {
  .spellRowTop {
    flex-wrap: nowrap;
  }

  .spellName {
    width: auto;
  }

  .spellLevelTitle input {
    width: auto;
  }
}

/* ======================
   Layout Safeguards + Small UX Helpers
   ====================== */

/* Prevent flex children from forcing overflow */
.charTile,
.vitalHeader,
.resourceHeader,
.charHpRow {
  min-width: 0;
}

.vitalHeader,
.resourceHeader,
.charHpRow {
  flex-wrap: wrap;
}

/* Keep the label from pushing buttons off, and allow it to shrink */
.vitalHeader .charTileLabel,
.resourceHeader .charTileLabel {
  flex: 1 1 auto;
  min-width: 0;
}

/* Keep arrow/delete buttons from shrinking weirdly */
.vitalMoves,
.resourceHeader button {
  flex: 0 0 auto;
}

/* HP and resource number boxes behave better when narrow */
.charHpRow input {
  flex: 1 1 90px;
  width: auto;
  /* override the 90px lock when wrapping */
  min-width: 50px;
  max-width: 50px;
}

.fieldLabelRow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.collapseMini {
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  border-radius: 10px;
  padding: 4px 10px;
  line-height: 1;
  cursor: pointer;
}

.collapseMini:active {
  transform: translateY(1px);
}
